<!doctype html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>√ñdeme Hesaplama</title>
    <meta name="color-scheme" content="light dark" />

    <script>
      window.tailwind = { config: { darkMode: "class" } };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/tr.js"></script>

    <style>
      * {
        font-family: 'Work Sans', ui-sans-serif, system-ui, -apple-system, sans-serif;
      }
      
      .font-mono {
        font-family: 'JetBrains Mono', ui-monospace, monospace !important;
      }

      @keyframes slide-up {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fade-in {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); }
        50% { box-shadow: 0 0 30px rgba(6, 182, 212, 0.5); }
      }

      .animate-slide-up {
        animation: slide-up 0.5s ease-out forwards;
      }

      .animate-fade-in {
        animation: fade-in 0.4s ease-out forwards;
      }

      /* Flatpickr Styling */
      .flatpickr-calendar {
        font-family: 'Work Sans', ui-sans-serif, system-ui, -apple-system, sans-serif;
        border: none !important;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        border-radius: 1rem;
        overflow: hidden; 
      }
      
      .flatpickr-months {
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
        background: transparent;
        padding: 12px 12px 8px 12px;
        height: 44px;
      }

      .flatpickr-current-month {
        position: absolute;
        left: 0;
        right: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        font-weight: 500 !important;
      }
      
      .flatpickr-current-month .cur-month {
        font-weight: 500 !important;
        margin-right: 6px; 
      }
      
      .flatpickr-current-month input.cur-year {
        font-weight: 500 !important;
        font-size: inherit;
        padding: 0;
        margin: 0;
        vertical-align: middle;
        box-sizing: content-box;
      }

      .flatpickr-current-month .numInputWrapper {
        width: 6ch;
        display: inline-block;
      }

      .flatpickr-current-month .numInputWrapper input[type=number]::-webkit-inner-spin-button,
      .flatpickr-current-month .numInputWrapper input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      
      .flatpickr-current-month .numInputWrapper span.arrowUp,
      .flatpickr-current-month .numInputWrapper span.arrowDown {
        opacity: 1 !important;
        display: block;
        height: 10px;
        padding: 0;
        border: none;
        right: -18px;
      }
      
      .flatpickr-current-month .numInputWrapper span.arrowUp:after { border-bottom-color: #64748b !important; top: 40%; }
      .flatpickr-current-month .numInputWrapper span.arrowDown:after { border-top-color: #64748b !important; top: 40%; }
      
      .dark .flatpickr-current-month .numInputWrapper span.arrowUp:after { border-bottom-color: #94a3b8 !important; }
      .dark .flatpickr-current-month .numInputWrapper span.arrowDown:after { border-top-color: #94a3b8 !important; }
      
      .flatpickr-current-month .numInputWrapper span.arrowUp:hover:after { border-bottom-color: #06b6d4 !important; }
      .flatpickr-current-month .numInputWrapper span.arrowDown:hover:after { border-top-color: #06b6d4 !important; }

      .flatpickr-prev-month, .flatpickr-next-month {
        position: relative !important;
        height: 28px;
        width: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        top: 0;
        z-index: 10;
      }
      
      .flatpickr-prev-month svg, .flatpickr-next-month svg { 
        fill: #334155 !important;
        width: 14px; 
        height: 14px;
      }
      
      .dark .flatpickr-calendar {
        background: #1e293b; 
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255,255,255,0.1) !important;
      }
      
      .dark .flatpickr-current-month { color: #f8fafc; }
      .dark .flatpickr-months .flatpickr-month { color: #f8fafc; }
      .dark span.flatpickr-weekday { color: #94a3b8 !important; background: transparent; }

      .dark .flatpickr-prev-month svg, .dark .flatpickr-next-month svg { fill: #f8fafc !important; }
      .dark .flatpickr-prev-month:hover svg, .dark .flatpickr-next-month:hover svg { fill: #22d3ee !important; }

      .flatpickr-days { border-top: 1px solid rgba(0,0,0,0.05); }
      .dark .flatpickr-days { border-top: 1px solid rgba(255,255,255,0.05); }
      
      .dark .flatpickr-day { color: #cbd5e1; }
      .dark .flatpickr-day.flatpickr-disabled { color: #475569; }
      .dark .flatpickr-day:hover { background: #334155; border-color: #334155; }
      
      .flatpickr-day.selected, .flatpickr-day.selected:hover {
        background: #06b6d4;
        border-color: #06b6d4;
        color: white;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }

      .dark ::-webkit-scrollbar-thumb {
        background: #475569;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      /* Tooltip */
      .tooltip {
        position: relative;
      }

      .tooltip:hover::after {
        content: attr(data-tip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%) translateY(-4px);
        padding: 6px 12px;
        background: rgba(15, 23, 42, 0.95);
        color: white;
        font-size: 12px;
        border-radius: 6px;
        white-space: nowrap;
        z-index: 1000;
        animation: fade-in 0.2s ease-out;
      }

      .dark .tooltip:hover::after {
        background: rgba(248, 250, 252, 0.95);
        color: #0f172a;
      }
    </style>
  </head>
  <body class="min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect, useRef } = React;

      /* ---------- Logic Helpers ---------- */
      function startOfDayLocal(d) {
        const x = new Date(d.getFullYear(), d.getMonth(), d.getDate());
        x.setHours(0,0,0,0);
        return x;
      }
      function todayYMD() {
        const t = new Date();
        const y = t.getFullYear();
        const m = String(t.getMonth()+1).padStart(2, "0");
        const d = String(t.getDate()).padStart(2, "0");
        return `${y}-${m}-${d}`;
      }
      function parseYMD(ymd) {
        const [y, m, d] = ymd.split("-").map(Number);
        return new Date(y, (m||1)-1, d||1);
      }
      function formatYMDLocal(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth()+1).padStart(2, "0");
        const d = String(date.getDate()).padStart(2, "0");
        return `${y}-${m}-${d}`;
      }
      function addMonthsLocal(date, totalMonths) {
        const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
        d.setMonth(d.getMonth() + totalMonths);
        return d;
      }
      function diffDaysLocal(a, b) {
        const A = startOfDayLocal(a).getTime();
        const B = startOfDayLocal(b).getTime();
        const MS = 86400000;
        return Math.floor((B - A) / MS);
      }
      function formatDDMMYYYY(date) {
        const d = String(date.getDate()).padStart(2,"0");
        const m = String(date.getMonth()+1).padStart(2,"0");
        const y = date.getFullYear();
        return `${d}/${m}/${y}`;
      }
      function formatTRInput(val) {
        if (!val) return "";
        const digits = val.toString().replace(/\D/g, ""); 
        if (!digits) return "";
        return Number(digits).toLocaleString("tr-TR");
      }
      function parseTRInput(val) {
        if (!val) return 0;
        const digits = val.toString().replace(/\./g, "").replace(/,/g, ".");
        return Number(digits);
      }

      /* ---------- Hooks ---------- */
      function useFlatpickr(ymd, onChangeYMD) {
        const ref = useRef(null);
        useEffect(() => {
          if (!ref.current) return;
          const initial = parseYMD(ymd);
          const fp = flatpickr(ref.current, {
            dateFormat: "d/m/Y",
            defaultDate: initial,
            locale: flatpickr.l10ns.tr,
            disableMobile: true, 
            animate: false,
            onChange: (dates) => {
              if (dates.length) {
                onChangeYMD(formatYMDLocal(dates[0]));
              }
            },
          });
          return () => fp.destroy();
        }, []);
        return ref;
      }

      function App() {
        const prefersDark = typeof window !== "undefined"
          && window.matchMedia?.("(prefers-color-scheme: dark)").matches;
        const [theme, setTheme] = useState(() =>
          localStorage.getItem("odeme-theme") || (prefersDark ? "dark" : "light")
        );
        useEffect(() => {
          localStorage.setItem("odeme-theme", theme);
          document.documentElement.classList.toggle("dark", theme === "dark");
        }, [theme]);
        const isDark = theme === "dark";

        // State
        const [amountStr, setAmountStr] = useState("");
        const [yearsStr, setYearsStr] = useState("1");
        const [monthsStr, setMonthsStr] = useState("0");
        const [saleDate, setSaleDate] = useState(todayYMD());
        const [asOfDate, setAsOfDate] = useState(todayYMD());
        const [showExport, setShowExport] = useState(false);

        const saleRef = useFlatpickr(saleDate, setSaleDate);
        const asOfRef  = useFlatpickr(asOfDate, setAsOfDate);

        const fmt = new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY",maximumFractionDigits:0});
        const fmtNum = new Intl.NumberFormat("tr-TR",{maximumFractionDigits:0});
        const pct = (n,d)=> d<=0?0:Math.min(100,Math.max(0,(n/d)*100));

        const handleAmountChange = (e) => setAmountStr(formatTRInput(e.target.value));

        // Quick preset buttons
        const setQuickAmount = (amount) => setAmountStr(formatTRInput(amount.toString()));

        // Calc
        const result = useMemo(() => {
          const amountNum = parseTRInput(amountStr);
          if (!saleDate || !asOfDate || !amountNum || amountNum <= 0) return null;
          const sale = parseYMD(saleDate);
          const asof = parseYMD(asOfDate);
          const y = parseInt(yearsStr || "0", 10);
          const m = parseInt(monthsStr || "0", 10);
          const totalMonthsDuration = (isNaN(y)?0:y*12) + (isNaN(m)?0:m);
          if (totalMonthsDuration <= 0) return null;

          const end = addMonthsLocal(sale, totalMonthsDuration);
          const totalDays = Math.max(0, diffDaysLocal(sale, end));
          const elapsedRaw = diffDaysLocal(sale, asof);
          const elapsed = Math.min(Math.max(0, elapsedRaw), totalDays);
          const remainingDays = Math.max(0, totalDays - elapsed);
          const dailyRate = totalDays>0 ? amountNum/totalDays : 0;
          const recognized = dailyRate * elapsed;
          const remaining = Math.max(0, amountNum - recognized);

          return { totalDays, elapsed, remainingDays, dailyRate, recognized, remaining, endDate: end, sale, asof, amountNum };
        }, [amountStr, yearsStr, monthsStr, saleDate, asOfDate]);

        // Export to CSV
        const exportToCSV = () => {
          if (!result) return;
          const rows = [
            ["Alan", "Deƒüer"],
            ["S√∂zle≈üme Tutarƒ±", Math.round(result.amountNum)],
            ["Kalan Tutar", Math.round(result.remaining)],
            ["Ge√ßen Tutar", Math.round(result.recognized)],
            ["G√ºnl√ºk Oran", Math.round(result.dailyRate)],
            ["Satƒ±≈ü Tarihi", formatDDMMYYYY(result.sale)],
            ["Hesaplama Tarihi", formatDDMMYYYY(result.asof)],
            ["S√∂zle≈üme Biti≈üi", formatDDMMYYYY(result.endDate)],
            ["Toplam G√ºn", result.totalDays],
            ["Ge√ßen G√ºn", result.elapsed],
            ["Kalan G√ºn", result.remainingDays],
          ];
          const csv = rows.map(r => r.join(",")).join("\n");
          const blob = new Blob(["\uFEFF" + csv], { type: "text/csv;charset=utf-8;" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `odeme-hesaplama-${formatYMDLocal(new Date())}.csv`;
          a.click();
          URL.revokeObjectURL(url);
        };

        // Reset all fields
        const handleReset = () => {
          setAmountStr("");
          setYearsStr("1");
          setMonthsStr("0");
          setSaleDate(todayYMD());
          setAsOfDate(todayYMD());
        };

        return (
          <div className={
            "min-h-screen w-full transition-colors duration-300 " +
            (isDark
              ? "bg-gradient-to-br from-slate-950 via-slate-900 to-slate-800 text-slate-100"
              : "bg-gradient-to-br from-slate-50 via-white to-slate-100 text-slate-900")
          }>
            {/* Header */}
            <header className="px-4 sm:px-6 pt-6 sm:pt-8 pb-4 max-w-7xl mx-auto">
              <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                <div className="animate-slide-up">
                  <h1 className="text-3xl sm:text-4xl font-bold tracking-tight bg-gradient-to-r from-cyan-500 to-blue-600 bg-clip-text text-transparent">
                    √ñdeme Hesaplama
                  </h1>
                  <p className="mt-2 text-sm text-slate-600 dark:text-slate-400">
                    S√∂zle≈üme √∂demelerinizi g√ºnl√ºk bazda hesaplayƒ±n
                  </p>
                </div>
                <div className="flex items-center gap-2 animate-fade-in">
                  <button
                    onClick={() => setTheme(isDark ? "light" : "dark")}
                    className={
                      "group relative select-none rounded-xl px-4 py-2.5 text-sm font-medium border transition-all duration-300 " +
                      (isDark
                        ? "bg-white/10 border-white/20 hover:bg-white/20 text-slate-100 hover:border-white/30"
                        : "bg-white border-slate-200 hover:bg-slate-50 text-slate-900 shadow-sm hover:shadow")
                    }
                    data-tip={isDark ? "A√ßƒ±k Tema" : "Koyu Tema"}
                  >
                    <span className="flex items-center gap-2">
                      {isDark ? "‚òÄÔ∏è A√ßƒ±k" : "üåô Koyu"}
                    </span>
                  </button>
                  {result && (
                    <button
                      onClick={exportToCSV}
                      className={
                        "group relative select-none rounded-xl px-4 py-2.5 text-sm font-medium border transition-all duration-300 " +
                        (isDark
                          ? "bg-cyan-500/20 border-cyan-500/30 hover:bg-cyan-500/30 text-cyan-200 hover:border-cyan-500/40"
                          : "bg-cyan-50 border-cyan-200 hover:bg-cyan-100 text-cyan-900 shadow-sm hover:shadow")
                      }
                      data-tip="CSV olarak indir"
                    >
                      <span className="flex items-center gap-2">
                        üìä Dƒ±≈üa Aktar
                      </span>
                    </button>
                  )}
                </div>
              </div>
            </header>

            <main className="px-4 sm:px-6 pb-12 grid grid-cols-1 lg:grid-cols-3 gap-6 items-start max-w-7xl mx-auto">
              {/* --- INPUTS --- */}
              <section className="lg:col-span-1 animate-slide-up" style={{animationDelay: "0.1s"}}>
                <div className={
                  "rounded-2xl p-6 border transition-all duration-300 " +
                  (isDark
                    ? "backdrop-blur-xl bg-white/5 border-white/10 shadow-2xl shadow-black/30 hover:bg-white/[0.07]"
                    : "bg-white border-slate-200 shadow-lg hover:shadow-xl")
                }>
                  <div className="flex items-center justify-between mb-5">
                    <h2 className="text-lg font-semibold">Girdiler</h2>
                    <button
                      onClick={handleReset}
                      className={
                        "text-xs px-3 py-1.5 rounded-lg transition-all " +
                        (isDark
                          ? "bg-white/5 hover:bg-white/10 text-slate-400 hover:text-slate-200"
                          : "bg-slate-100 hover:bg-slate-200 text-slate-600 hover:text-slate-900")
                      }
                    >
                      Sƒ±fƒ±rla
                    </button>
                  </div>
                  
                  <div className="space-y-5">
                    
                    {/* Amount */}
                    <div>
                      <label className={"block text-sm mb-2 font-medium " + (isDark ? "text-slate-300" : "text-slate-700")} htmlFor="amount">
                        Satƒ±≈ü Tutarƒ±
                      </label>
                      <div className="relative group">
                        <input id="amount" type="text" inputMode="numeric" placeholder="365.000"
                          value={amountStr} onChange={handleAmountChange}
                          className={
                            "w-full rounded-xl pl-4 pr-12 py-3 outline-none focus:ring-2 transition-all font-mono text-lg " +
                            (isDark
                              ? "bg-white/10 border border-white/10 focus:ring-cyan-400/50 focus:border-cyan-400/30 placeholder-slate-500"
                              : "bg-slate-50 border border-slate-200 focus:ring-cyan-300 focus:border-cyan-400 placeholder-slate-400")
                          } />
                        <div className={"absolute right-4 top-3.5 pointer-events-none text-base font-medium " + (isDark ? "text-slate-400" : "text-slate-500")}>‚Ç∫</div>
                      </div>
                      
                      {/* Quick amount buttons */}
                      <div className="flex gap-2 mt-3">
                        {[100000, 250000, 500000, 1000000].map(amt => (
                          <button
                            key={amt}
                            onClick={() => setQuickAmount(amt)}
                            className={
                              "flex-1 text-xs py-1.5 rounded-lg transition-all " +
                              (isDark
                                ? "bg-white/5 hover:bg-cyan-500/20 border border-white/10 hover:border-cyan-500/30 text-slate-400 hover:text-cyan-300"
                                : "bg-slate-100 hover:bg-cyan-50 border border-slate-200 hover:border-cyan-200 text-slate-600 hover:text-cyan-700")
                            }
                          >
                            {amt >= 1000000 ? `${amt/1000000}M` : `${amt/1000}K`}
                          </button>
                        ))}
                      </div>
                    </div>

                    {/* Duration */}
                    <div>
                      <label className={"block text-sm mb-2 font-medium " + (isDark ? "text-slate-300" : "text-slate-700")}>S√∂zle≈üme S√ºresi</label>
                      <div className="flex gap-3">
                        <div className="flex-1 relative">
                          <input id="years" type="number" min="0" value={yearsStr}
                            onChange={(e) => setYearsStr(e.target.value)}
                            className={
                              "w-full rounded-xl pl-4 pr-12 py-3 outline-none focus:ring-2 transition-all text-center text-lg " +
                              (isDark
                                ? "bg-white/10 border border-white/10 focus:ring-cyan-400/50 focus:border-cyan-400/30"
                                : "bg-slate-50 border border-slate-200 focus:ring-cyan-300 focus:border-cyan-400")
                            } />
                           <span className={"absolute right-4 top-3.5 text-xs font-medium pointer-events-none " + (isDark ? "text-slate-400" : "text-slate-500")}>Yƒ±l</span>
                        </div>
                        <div className="flex-1 relative">
                          <input id="months" type="number" min="0" max="11" value={monthsStr}
                            onChange={(e) => setMonthsStr(e.target.value)}
                            className={
                              "w-full rounded-xl pl-4 pr-12 py-3 outline-none focus:ring-2 transition-all text-center text-lg " +
                              (isDark
                                ? "bg-white/10 border border-white/10 focus:ring-cyan-400/50 focus:border-cyan-400/30"
                                : "bg-slate-50 border border-slate-200 focus:ring-cyan-300 focus:border-cyan-400")
                            } />
                            <span className={"absolute right-4 top-3.5 text-xs font-medium pointer-events-none " + (isDark ? "text-slate-400" : "text-slate-500")}>Ay</span>
                        </div>
                      </div>
                    </div>

                    {/* Dates */}
                    <div className="grid grid-cols-1 gap-4">
                      <div>
                        <label className={"block text-sm mb-2 font-medium " + (isDark ? "text-slate-300" : "text-slate-700")} htmlFor="saleDate">Satƒ±≈ü Tarihi</label>
                        <div className="relative group">
                          <input ref={saleRef} id="saleDate"
                            className={
                              "w-full rounded-xl pl-4 pr-12 py-3 outline-none focus:ring-2 transition-all cursor-pointer " +
                              (isDark
                                ? "bg-white/10 border border-white/10 focus:ring-cyan-400/50 focus:border-cyan-400/30"
                                : "bg-slate-50 border border-slate-200 focus:ring-cyan-300 focus:border-cyan-400")
                            } />
                          <div className={"absolute right-4 top-3.5 pointer-events-none transition-colors " + (isDark ? "text-slate-400 group-hover:text-cyan-400" : "text-slate-500 group-hover:text-cyan-500")}>
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                          </div>
                        </div>
                      </div>
                      <div>
                        <label className={"block text-sm mb-2 font-medium " + (isDark ? "text-slate-300" : "text-slate-700")} htmlFor="asOfDate">Hesaplama Tarihi</label>
                        <div className="relative group">
                          <input ref={asOfRef} id="asOfDate"
                            className={
                              "w-full rounded-xl pl-4 pr-12 py-3 outline-none focus:ring-2 transition-all cursor-pointer " +
                              (isDark
                                ? "bg-white/10 border border-white/10 focus:ring-cyan-400/50 focus:border-cyan-400/30"
                                : "bg-slate-50 border border-slate-200 focus:ring-cyan-300 focus:border-cyan-400")
                            } />
                           <div className={"absolute right-4 top-3.5 pointer-events-none transition-colors " + (isDark ? "text-slate-400 group-hover:text-cyan-400" : "text-slate-500 group-hover:text-cyan-500")}>
                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                          </div>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </section>

              {/* --- RESULTS --- */}
              <section className="lg:col-span-2 animate-slide-up" style={{animationDelay: "0.2s"}}>
                <div className={
                  "rounded-2xl p-6 border transition-all duration-300 min-h-[500px] flex flex-col " +
                  (isDark
                    ? "backdrop-blur-xl bg-white/5 border-white/10 shadow-2xl shadow-black/30 hover:bg-white/[0.07]"
                    : "bg-white border-slate-200 shadow-lg hover:shadow-xl")
                }>
                  <h2 className="text-lg font-semibold mb-6">Sonu√ßlar</h2>

                  {!result ? (
                    <div className="flex-1 flex flex-col items-center justify-center text-center p-8">
                      <div className={
                        "w-28 h-28 mb-5 rounded-2xl flex items-center justify-center transition-all " + 
                        (isDark ? "bg-slate-800/50 text-slate-600" : "bg-slate-100 text-slate-400")
                      }>
                        <svg className="w-14 h-14" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                           <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                      </div>
                      <h3 className={"text-xl font-semibold mb-2 " + (isDark ? "text-slate-300" : "text-slate-700")}>
                        Hesaplama Bekleniyor
                      </h3>
                      <p className={"text-sm max-w-sm mx-auto " + (isDark ? "text-slate-500" : "text-slate-500")}>
                        Sol taraftaki panelden gerekli bilgileri girerek √∂deme hesaplamasƒ±na ba≈ülayƒ±n
                      </p>
                    </div>
                  ) : (
                    <div className="space-y-8 animate-fade-in">
                      {/* KPI Cards */}
                      <div className="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
                        <KPI label="S√∂zle≈üme Tutarƒ±" value={fmt.format(result.amountNum)} isDark={isDark} icon="üìÑ" />
                        <KPI label="Kalan Tutar" value={fmt.format(Math.round(result.remaining))} highlight isDark={isDark} allowCopy icon="üí∞" />
                        <KPI label="Ge√ßen Tutar" value={fmt.format(Math.round(result.recognized))} isDark={isDark} icon="‚úÖ" />
                        <KPI label="G√ºnl√ºk Oran" value={fmt.format(Math.round(result.dailyRate))} isDark={isDark} icon="üìä" />
                      </div>

                      {/* Progress Bar */}
                      <div>
                        <div className="flex items-end justify-between mb-3">
                          <span className={"text-sm font-medium flex items-center gap-2 " + (isDark ? "text-slate-300" : "text-slate-700")}>
                            <span>üìà</span>
                            ƒ∞lerleme Durumu
                          </span>
                          <span className={"text-xs font-mono font-semibold " + (isDark ? "text-cyan-400" : "text-cyan-600")}>
                            {fmtNum.format(result.elapsed)} / {fmtNum.format(result.totalDays)} g√ºn ¬∑ %{pct(result.elapsed, result.totalDays).toFixed(1)}
                          </span>
                        </div>
                        <div className={"h-5 w-full rounded-full overflow-hidden relative " + (isDark ? "bg-white/5 ring-1 ring-white/10" : "bg-slate-200 ring-1 ring-slate-300")}>
                          <div 
                            className="h-full transition-all duration-1000 ease-out relative bg-gradient-to-r from-cyan-500 to-blue-500" 
                            style={{ width: pct(result.elapsed, result.totalDays) + "%" }}
                          >
                            <div className="absolute inset-0 bg-white/20 animate-pulse"></div>
                          </div>
                        </div>
                        <div className={"flex items-center justify-between text-xs mt-2.5 " + (isDark ? "text-slate-400" : "text-slate-500")}>
                          <span className="font-medium">üöÄ {formatDDMMYYYY(result.sale)}</span>
                          <span className="font-medium">üèÅ {formatDDMMYYYY(result.endDate)}</span>
                        </div>
                      </div>

                      {/* Details Table */}
                      <div className={"overflow-hidden rounded-xl border " + (isDark ? "border-white/10" : "border-slate-200")}>
                        <table className="w-full text-sm">
                          <tbody>
                            <Row k="Satƒ±≈ü Tarihi"      v={formatDDMMYYYY(result.sale)}     isDark={isDark} icon="üìÖ" />
                            <Row k="Hesaplama Tarihi"  v={formatDDMMYYYY(result.asof)}     isDark={isDark} icon="üóìÔ∏è" />
                            <Row k="S√∂zle≈üme Biti≈üi"   v={formatDDMMYYYY(result.endDate)}  isDark={isDark} icon="üèÅ" />
                            <Row k="Toplam G√ºn"        v={fmtNum.format(result.totalDays)}      isDark={isDark} icon="üìÜ" />
                            <Row k="Ge√ßen G√ºn"         v={fmtNum.format(result.elapsed)}        isDark={isDark} icon="‚úîÔ∏è" />
                            <Row k="Kalan G√ºn"         v={fmtNum.format(result.remainingDays)}  isDark={isDark} icon="‚è≥" />
                            <Row k="Ge√ßen Tutar"  v={fmt.format(Math.round(result.recognized))} isDark={isDark} icon="üíµ" />
                            <Row k="Kalan Tutar"       v={fmt.format(Math.round(result.remaining))}  isDark={isDark} icon="üí∞" />
                          </tbody>
                        </table>
                      </div>
                    </div>
                  )}
                </div>
              </section>
            </main>

            {/* Footer */}
            <footer className="px-6 py-6 text-center text-xs text-slate-500 dark:text-slate-600 max-w-7xl mx-auto">
              <p>G√ºnl√ºk bazlƒ± √∂deme hesaplama aracƒ± ¬∑ T√ºm tutarlar TRY cinsinden</p>
            </footer>
          </div>
        );
      }

      // --- KPI Component with Copy Logic ---
      function KPI({ label, value, highlight=false, isDark, allowCopy=false, icon="" }) {
        const [copied, setCopied] = useState(false);

        const handleCopy = () => {
          if (!value) return;
          const cleanValue = value.toString().replace("‚Ç∫", "").trim();
          navigator.clipboard.writeText(cleanValue);
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        };

        return (
          <div className={
            "relative rounded-2xl p-5 border transition-all duration-300 group " +
            (highlight
              ? (isDark 
                ? "bg-gradient-to-br from-cyan-500/20 to-blue-500/10 border-cyan-500/40 hover:border-cyan-400/60 shadow-lg hover:shadow-cyan-500/20" 
                : "bg-gradient-to-br from-cyan-50 to-blue-50 border-cyan-300 hover:border-cyan-400 shadow-md hover:shadow-lg")
              : (isDark 
                ? "bg-white/5 border-white/10 hover:border-white/20 hover:bg-white/[0.07]"     
                : "bg-slate-50 border-slate-200 hover:border-slate-300 shadow-sm hover:shadow-md"))
          }>
            <div className="flex justify-between items-start mb-2">
              <div className="flex items-center gap-2">
                {icon && <span className="text-base">{icon}</span>}
                <div className={"text-xs font-medium " + (isDark ? "text-slate-400" : "text-slate-600")}>{label}</div>
              </div>
              
              {allowCopy && (
                <button 
                  onClick={handleCopy}
                  title="Tutarƒ± Kopyala"
                  className={
                    "p-1.5 -mr-1 -mt-1 rounded-lg transition-all duration-200 opacity-0 group-hover:opacity-100 focus:opacity-100 " +
                    (isDark 
                      ? "hover:bg-white/20 text-slate-400 hover:text-white" 
                      : "hover:bg-black/10 text-slate-400 hover:text-slate-900")
                  }
                >
                  {copied ? (
                    <svg className="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M5 13l4 4L19 7"></path></svg>
                  ) : (
                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                  )}
                </button>
              )}
            </div>
            
            <div className={
              "text-2xl md:text-3xl font-bold tracking-tight truncate font-mono " + 
              (highlight 
                ? (isDark ? "text-cyan-300" : "text-cyan-700") 
                : (isDark ? "text-slate-100" : "text-slate-900"))
            }>
              {value}
            </div>
          </div>
        );
      }

      function Row({ k, v, isDark, icon="" }) {
        return (
          <tr className={
            "group transition-colors " + 
            (isDark ? "odd:bg-white/0 even:bg-white/[0.03] hover:bg-white/10" : "odd:bg-white even:bg-slate-50 hover:bg-slate-100")
          }>
            <td className={
              "px-5 py-3.5 w-2/5 transition-colors font-medium " + 
              (isDark ? "text-slate-400 group-hover:text-slate-200" : "text-slate-600 group-hover:text-slate-900")
            }>
              <span className="flex items-center gap-2">
                {icon && <span className="text-sm">{icon}</span>}
                {k}
              </span>
            </td>
            <td className={
              "px-5 py-3.5 font-semibold font-mono " + 
              (isDark ? "text-slate-100" : "text-slate-900")
            }>
              {v}
            </td>
          </tr>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>